<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Controle Financeiro - Regional 2</title>
    
    <!-- React e ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel para compilar JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Chart.js para Gráficos -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- FontAwesome para ícones -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Configurações de Estilo Personalizado (Tailwind Config) -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        gold: {
                            50: '#fbf8eb',
                            100: '#f5efcd',
                            200: '#ede09f',
                            300: '#e4cc68',
                            400: '#dcb63f',
                            500: '#c5a059', // Dourado Principal
                            600: '#a67c2e',
                            700: '#855e25',
                            800: '#6e4b23',
                            900: '#5b3d20',
                        },
                        navy: {
                            800: '#1e293b',
                            900: '#0f172a',
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'Segoe UI', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #c5a059; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #a67c2e; }

        .fade-in { animation: fadeIn 0.4s cubic-bezier(0.16, 1, 0.3, 1); }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Tabela Específica com Bordas Pretas */
        .table-departments { border-collapse: collapse; width: 100%; }
        .table-departments th, .table-departments td { border: 1px solid black; padding: 8px; text-align: right; }
        .table-departments th { background-color: #f0f0f0; text-align: center; font-weight: bold; text-transform: uppercase; font-size: 0.8rem; }
        .table-departments td:first-child { text-align: left; font-weight: 600; }
        .table-departments input { width: 100%; border: none; background: transparent; text-align: right; outline: none; font-family: inherit; }
        .table-departments input:focus { background-color: #fff9db; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        // --- Configurações Iniciais e Credenciais Padrão ---
        const DEFAULT_CONGREGACOES = [
            "Vila Santa Maria", "Jardim Almanara", "Parque Pedroso", 
            "Jardim dos Francos", "Vila Penteado", "Vila Acre", 
            "Jardim das Graças", "Trivelato", "Casa Verde Alta", 
            "Vila Santista", "Casa Verde 2"
        ];

        const DEFAULT_DEPARTAMENTOS = [
            "EBD", "ASSISTÊNCIA SOCIAL", "CÍRCULO DE ORAÇÃO", "ENCONTRO DE CASAIS",
            "MOCIDADE", "ADOLESCENTES", "MISSÕES LOCAL", "CRIANÇAS",
            "TARDE DA BENÇÃO", "REFORMAS E CONSTRUÇÃO", "CAMPANHAS DIVERSAS"
        ];

        const DEFAULT_CREDENTIALS = {
            'Admin': 'adm123',
            'Vila Santa Maria': 'santamaria123',
            'Jardim Almanara': 'almanara123',
            'Casa Verde Alta': 'verdealta123',
            'Casa Verde 2': 'casaverde123',
            'Parque Pedroso': 'pedroso123',
            'Jardim dos Francos': 'francos123',
            'Vila Penteado': 'penteado123',
            'Vila Acre': 'acre123',
            'Jardim das Graças': 'gracas123',
            'Trivelato': 'trivelato123',
            'Vila Santista': 'santista123'
        };
        
        const DEFAULT_APP_CONFIG = {
            appName: "Regional 2",
            logo: null // Base64 string
        };

        // --- Componentes Auxiliares ---
        const formatCurrency = (value) => new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(value || 0);

        const SidebarItem = ({ icon, label, active, onClick }) => (
            <div 
                onClick={onClick}
                className={`flex items-center gap-3 px-4 py-3 rounded-lg cursor-pointer transition-all duration-200 mb-1 select-none
                ${active ? 'bg-gold-500 text-white shadow-lg' : 'text-gray-400 hover:bg-navy-800 hover:text-gold-300'}`}
            >
                <i className={`fas ${icon} w-5 text-center`}></i>
                <span className="font-medium">{label}</span>
            </div>
        );

        const StatCard = ({ title, value, type, icon }) => {
            const bgIconColor = {
                default: "bg-gray-100 text-gray-400",
                success: "bg-green-50 text-green-400",
                danger: "bg-red-50 text-red-400",
                primary: "bg-gold-50 text-gold-400"
            };
            return (
                <div className={`bg-white p-6 rounded-xl shadow-sm hover:shadow-md transition-all border border-gray-100 relative overflow-hidden group`}>
                    <div className="flex justify-between items-start">
                        <div>
                            <p className="text-xs font-semibold text-gray-400 uppercase tracking-wider mb-1">{title}</p>
                            <h3 className={`text-2xl font-bold ${type === 'danger' ? 'text-red-600' : type === 'success' ? 'text-green-600' : type === 'primary' ? 'text-gold-600' : 'text-gray-700'}`}>
                                {formatCurrency(value)}
                            </h3>
                        </div>
                        <div className={`p-3 rounded-lg ${bgIconColor[type]}`}>
                            <i className={`fas ${icon} text-xl`}></i>
                        </div>
                    </div>
                </div>
            );
        };

        const ChartComponent = ({ type, data, options }) => {
            const chartRef = useRef(null);
            const canvasRef = useRef(null);
            const instanceRef = useRef(null);

            useEffect(() => {
                if (canvasRef.current) {
                    if (instanceRef.current) instanceRef.current.destroy();
                    Chart.defaults.font.family = "'Inter', sans-serif";
                    Chart.defaults.color = '#6b7280';
                    instanceRef.current = new Chart(canvasRef.current, { type, data, options });
                }
                return () => { if (instanceRef.current) instanceRef.current.destroy(); };
            }, [data, options, type]);

            return <canvas ref={canvasRef} />;
        };

        // --- Componente de Login ---
        const LoginScreen = ({ usersList, credentials, appConfig, onLogin }) => {
            const [selectedUser, setSelectedUser] = useState("");
            const [password, setPassword] = useState("");
            const [showPassword, setShowPassword] = useState(false);
            const [error, setError] = useState("");

            const handleLogin = (e) => {
                e.preventDefault();
                if (!selectedUser) { setError("Selecione um usuário."); return; }
                
                if (credentials[selectedUser] === password) {
                    onLogin(selectedUser);
                } else {
                    setError("Senha incorreta.");
                }
            };

            return (
                <div className="min-h-screen bg-navy-900 flex items-center justify-center p-4">
                    <div className="bg-white rounded-2xl shadow-2xl w-full max-w-md overflow-hidden fade-in">
                        <div className="bg-gold-500 p-8 text-center">
                            {appConfig.logo ? (
                                <img src={appConfig.logo} alt="Logo" className="w-24 h-24 object-contain bg-white rounded-full p-2 mx-auto mb-4 shadow-lg" />
                            ) : (
                                <div className="w-16 h-16 bg-white rounded-full flex items-center justify-center text-gold-600 text-3xl mx-auto mb-4 shadow-lg">
                                    <i className="fas fa-church"></i>
                                </div>
                            )}
                            <h2 className="text-2xl font-bold text-white">{appConfig.appName}</h2>
                            <p className="text-gold-100 text-sm">Controle Financeiro</p>
                        </div>
                        <form onSubmit={handleLogin} className="p-8 space-y-6">
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-2">Usuário / Congregação</label>
                                <select 
                                    value={selectedUser} 
                                    onChange={(e) => { setSelectedUser(e.target.value); setError(""); }}
                                    className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gold-500 outline-none bg-gray-50"
                                >
                                    <option value="">Selecione...</option>
                                    <option value="Admin">Admin (Secretário Geral)</option>
                                    <optgroup label="Congregações">
                                        {usersList.map(u => <option key={u} value={u}>{u}</option>)}
                                    </optgroup>
                                </select>
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-2">Senha de Acesso</label>
                                <div className="relative">
                                    <input 
                                        type={showPassword ? "text" : "password"}
                                        value={password}
                                        onChange={(e) => { setPassword(e.target.value); setError(""); }}
                                        className="w-full p-3 pl-10 pr-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gold-500 outline-none"
                                        placeholder="••••••"
                                    />
                                    <i className="fas fa-lock absolute left-3 top-3.5 text-gray-400"></i>
                                    <button 
                                        type="button"
                                        onClick={() => setShowPassword(!showPassword)}
                                        className="absolute right-3 top-3.5 text-gray-500 hover:text-gold-600 focus:outline-none"
                                    >
                                        <i className={`fas ${showPassword ? 'fa-eye-slash' : 'fa-eye'}`}></i>
                                    </button>
                                </div>
                            </div>
                            
                            {error && <div className="p-3 bg-red-50 text-red-600 text-sm rounded-lg flex items-center gap-2"><i className="fas fa-exclamation-circle"></i> {error}</div>}
                            
                            <button type="submit" className="w-full py-3 bg-navy-800 text-white font-bold rounded-lg hover:bg-navy-900 transition shadow-lg">
                                Entrar no Sistema
                            </button>
                        </form>
                    </div>
                </div>
            );
        };

        // --- Aplicação Principal ---
        function App() {
            // -- Auth State --
            const [isAuthenticated, setIsAuthenticated] = useState(false);
            const [currentUser, setCurrentUser] = useState(null); // { name: string, role: 'admin' | 'user' }

            // -- App Config --
            const [appConfig, setAppConfig] = useState(DEFAULT_APP_CONFIG);
            const [credentials, setCredentials] = useState(DEFAULT_CREDENTIALS);

            // -- Data State --
            const [congregacoes, setCongregacoes] = useState(DEFAULT_CONGREGACOES);
            const [departamentos, setDepartamentos] = useState(DEFAULT_DEPARTAMENTOS);
            const [financialData, setFinancialData] = useState({});
            const [currentDate, setCurrentDate] = useState(new Date());
            
            // -- UI State --
            const [view, setView] = useState('dashboard'); 
            const [isModalOpen, setIsModalOpen] = useState(false);
            const [editingCongregation, setEditingCongregation] = useState(null);
            const [editValues, setEditValues] = useState({});
            const [selectedDetailCongregation, setSelectedDetailCongregation] = useState(null);

            // -- Admin UI State --
            const [newCongName, setNewCongName] = useState("");
            const [newCongPassword, setNewCongPassword] = useState("");
            const [newDeptName, setNewDeptName] = useState("");
            
            // Edit States for Admin
            const [editCongTarget, setEditCongTarget] = useState(null); // Which cong is being edited
            const [editCongName, setEditCongName] = useState("");
            const [editCongPass, setEditCongPass] = useState("");
            
            const [editDeptTarget, setEditDeptTarget] = useState(null);
            const [editDeptName, setEditDeptName] = useState("");

            // Carregar Dados e Configurações
            useEffect(() => {
                const savedData = localStorage.getItem('financeiro_regional2_v3_db');
                const savedCongs = localStorage.getItem('config_congregacoes');
                const savedDepts = localStorage.getItem('config_departamentos');
                const savedCreds = localStorage.getItem('config_credentials');
                const savedConfig = localStorage.getItem('config_app_v1');

                if (savedData) setFinancialData(JSON.parse(savedData));
                if (savedCongs) setCongregacoes(JSON.parse(savedCongs));
                if (savedDepts) setDepartamentos(JSON.parse(savedDepts));
                if (savedCreds) setCredentials(JSON.parse(savedCreds));
                if (savedConfig) setAppConfig(JSON.parse(savedConfig));
            }, []);

            // Salvar Persistência
            useEffect(() => {
                if (Object.keys(financialData).length > 0) localStorage.setItem('financeiro_regional2_v3_db', JSON.stringify(financialData));
            }, [financialData]);

            useEffect(() => {
                localStorage.setItem('config_congregacoes', JSON.stringify(congregacoes));
                localStorage.setItem('config_departamentos', JSON.stringify(departamentos));
                localStorage.setItem('config_credentials', JSON.stringify(credentials));
                localStorage.setItem('config_app_v1', JSON.stringify(appConfig));
            }, [congregacoes, departamentos, credentials, appConfig]);

            // --- Lógica de Datas ---
            const currentYear = currentDate.getFullYear();
            const currentMonth = currentDate.getMonth();
            const dateKey = `${currentYear}-${String(currentMonth + 1).padStart(2, '0')}`;
            const prevDate = new Date(currentYear, currentMonth - 1, 1);
            const prevDateKey = `${prevDate.getFullYear()}-${String(prevDate.getMonth() + 1).padStart(2, '0')}`;
            const monthNames = ["Janeiro", "Fevereiro", "Março", "Abril", "Maio", "Junho", "Julho", "Agosto", "Setembro", "Outubro", "Novembro", "Dezembro"];
            const changeMonth = (offset) => setCurrentDate(new Date(currentYear, currentMonth + offset, 1));

            // --- Handlers de Autenticação ---
            const handleLogin = (user) => {
                const role = user === 'Admin' ? 'admin' : 'user';
                setCurrentUser({ name: user, role });
                setIsAuthenticated(true);
                setView('dashboard');
            };

            const handleLogout = () => {
                setIsAuthenticated(false);
                setCurrentUser(null);
                setView('dashboard');
            };

            // --- Filtro de Dados por Permissão ---
            const visibleCongregations = useMemo(() => {
                if (!currentUser) return [];
                if (currentUser.role === 'admin') return congregacoes;
                return congregacoes.filter(c => c === currentUser.name);
            }, [currentUser, congregacoes]);

            // --- Lógica de Dados Financeiros ---
            const getCongregationFullData = (cong, key = dateKey) => {
                const rawData = financialData[key]?.[cong];
                const initialData = {};
                departamentos.forEach(dep => { initialData[dep] = { anterior: 0, entrada: 0, saida: 0 }; });
                return rawData ? { ...initialData, ...rawData } : initialData;
            };

            const calculateCongregationTotals = (congData) => {
                let t = { anterior: 0, entrada: 0, saida: 0, saldo: 0 };
                Object.values(congData).forEach(dep => {
                    t.anterior += Number(dep.anterior) || 0;
                    t.entrada += Number(dep.entrada) || 0;
                    t.saida += Number(dep.saida) || 0;
                });
                t.saldo = t.anterior + t.entrada - t.saida;
                return t;
            };

            const globalTotals = useMemo(() => {
                let t = { tAnterior: 0, tEntrada: 0, tSaida: 0, tAtual: 0 };
                visibleCongregations.forEach(cong => {
                    const data = getCongregationFullData(cong);
                    const totals = calculateCongregationTotals(data);
                    t.tAnterior += totals.anterior;
                    t.tEntrada += totals.entrada;
                    t.tSaida += totals.saida;
                    t.tAtual += totals.saldo;
                });
                return t;
            }, [financialData, dateKey, visibleCongregations, departamentos]);

            const departmentTotals = useMemo(() => {
                const totals = {};
                departamentos.forEach(dep => totals[dep] = { entrada: 0, saida: 0 });
                visibleCongregations.forEach(cong => {
                    const data = getCongregationFullData(cong);
                    departamentos.forEach(dep => {
                        totals[dep].entrada += Number(data[dep]?.entrada) || 0;
                        totals[dep].saida += Number(data[dep]?.saida) || 0;
                    });
                });
                return totals;
            }, [financialData, dateKey, visibleCongregations, departamentos]);

            // --- Admin Handlers (Configuração Geral) ---
            const handleLogoUpload = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onloadend = () => {
                        setAppConfig(prev => ({ ...prev, logo: reader.result }));
                    };
                    reader.readAsDataURL(file);
                }
            };

            // --- Admin Handlers (Congregações) ---
            const handleAddCongregation = () => {
                if (newCongName && !congregacoes.includes(newCongName) && newCongPassword) {
                    setCongregacoes([...congregacoes, newCongName]);
                    setCredentials(prev => ({ ...prev, [newCongName]: newCongPassword }));
                    setNewCongName("");
                    setNewCongPassword("");
                    alert("Congregação adicionada com sucesso!");
                } else if (!newCongPassword) {
                    alert("Por favor, defina uma senha para a nova congregação.");
                } else {
                    alert("Nome inválido ou já existente.");
                }
            };

            const initiateEditCongregation = (congName) => {
                setEditCongTarget(congName);
                setEditCongName(congName);
                setEditCongPass(credentials[congName] || "");
            };

            const saveEditCongregation = () => {
                if (!editCongName) return;

                // Atualizar lista de congregações
                const newCongs = congregacoes.map(c => c === editCongTarget ? editCongName : c);
                setCongregacoes(newCongs);

                // Atualizar Credenciais: Remove a antiga e adiciona a nova/atualizada
                const newCreds = { ...credentials };
                delete newCreds[editCongTarget];
                newCreds[editCongName] = editCongPass;
                setCredentials(newCreds);

                // Migrar Dados Financeiros (Renomear chave no objeto)
                const newFinancialData = { ...financialData };
                Object.keys(newFinancialData).forEach(date => {
                    if (newFinancialData[date][editCongTarget]) {
                        newFinancialData[date][editCongName] = newFinancialData[date][editCongTarget];
                        delete newFinancialData[date][editCongTarget];
                    }
                });
                setFinancialData(newFinancialData);

                setEditCongTarget(null);
                alert("Congregação atualizada!");
            };

            const handleDeleteCongregation = (congName) => {
                if (confirm(`Tem certeza que deseja excluir "${congName}"? Todos os dados financeiros serão perdidos.`)) {
                    setCongregacoes(congregacoes.filter(c => c !== congName));
                    
                    const newCreds = { ...credentials };
                    delete newCreds[congName];
                    setCredentials(newCreds);

                    const newFinancialData = { ...financialData };
                    Object.keys(newFinancialData).forEach(date => {
                        if (newFinancialData[date][congName]) {
                            delete newFinancialData[date][congName];
                        }
                    });
                    setFinancialData(newFinancialData);
                }
            };

            // --- Admin Handlers (Departamentos) ---
            const handleAddDepartment = () => {
                if (newDeptName && !departamentos.includes(newDeptName)) {
                    setDepartamentos([...departamentos, newDeptName]);
                    setNewDeptName("");
                    alert("Departamento adicionado!");
                }
            };

            const initiateEditDepartment = (depName) => {
                setEditDeptTarget(depName);
                setEditDeptName(depName);
            };

            const saveEditDepartment = () => {
                if (!editDeptName) return;
                setDepartamentos(departamentos.map(d => d === editDeptTarget ? editDeptName : d));
                
                // Nota: Renomear departamento não migra os dados internos do JSON financeiro automaticamente 
                // pela complexidade, mas novos lançamentos usarão o novo nome.
                // Para consistência total, deveríamos varrer financialData também.
                // Varreremos aqui para garantir:
                const newFinancialData = { ...financialData };
                Object.keys(newFinancialData).forEach(date => {
                    Object.keys(newFinancialData[date]).forEach(cong => {
                        const congData = newFinancialData[date][cong];
                        if (congData[editDeptTarget]) {
                            congData[editDeptName] = congData[editDeptTarget];
                            delete congData[editDeptTarget];
                        }
                    });
                });
                setFinancialData(newFinancialData);

                setEditDeptTarget(null);
            };

            const handleDeleteDepartment = (depName) => {
                if (confirm(`Excluir departamento "${depName}"?`)) {
                    setDepartamentos(departamentos.filter(d => d !== depName));
                    // Opcional: Limpar dados desse departamento do histórico financeiro
                }
            };

            // --- Modal & Edição ---
            const openEditModal = (cong) => {
                const currentData = getCongregationFullData(cong, dateKey);
                const prevMonthData = getCongregationFullData(cong, prevDateKey);
                const dataToEdit = JSON.parse(JSON.stringify(currentData));

                departamentos.forEach(dep => {
                    if ((!financialData[dateKey]?.[cong] || !financialData[dateKey]?.[cong][dep]) && dataToEdit[dep].anterior === 0) {
                        const prevDep = prevMonthData[dep];
                        const prevSaldo = (Number(prevDep?.anterior)||0) + (Number(prevDep?.entrada)||0) - (Number(prevDep?.saida)||0);
                        dataToEdit[dep].anterior = prevSaldo;
                    }
                });

                setEditingCongregation(cong);
                setEditValues(dataToEdit);
                setIsModalOpen(true);
            };

            const handleDepartmentChange = (dep, field, value) => {
                setEditValues(prev => ({ ...prev, [dep]: { ...prev[dep], [field]: parseFloat(value) || 0 } }));
            };

            const handleSave = (e) => {
                e.preventDefault();
                const newData = { ...financialData };
                if (!newData[dateKey]) newData[dateKey] = {};
                newData[dateKey][editingCongregation] = editValues;
                setFinancialData(newData);
                setIsModalOpen(false);
            };

            const modalTotals = useMemo(() => {
                if (!isModalOpen) return { anterior: 0, entrada: 0, saida: 0, saldo: 0 };
                return calculateCongregationTotals(editValues);
            }, [editValues, isModalOpen]);

            // --- Exportação ---
            const exportToCSV = (scope, targetCongregation = null) => {
                let csvContent = "data:text/csv;charset=utf-8,";
                csvContent += `Relatório (${monthNames[currentMonth]}/${currentYear}) - ${appConfig.appName}\n\n`;

                if (scope === 'dashboard') {
                    csvContent += "Congregação,Saldo Anterior,Entrada,Saída,Saldo Atual\n";
                    visibleCongregations.forEach(cong => {
                        const data = getCongregationFullData(cong);
                        const totals = calculateCongregationTotals(data);
                        csvContent += `"${cong}",${totals.anterior},${totals.entrada},${totals.saida},${totals.saldo}\n`;
                    });
                    csvContent += `TOTAL,${globalTotals.tAnterior},${globalTotals.tEntrada},${globalTotals.tSaida},${globalTotals.tAtual}\n`;
                } else if (scope === 'reports') {
                    csvContent += "CONSOLIDADO POR CONGREGAÇÃO\nCongregação,Entradas,Saídas,Saldo\n";
                    visibleCongregations.forEach(cong => {
                        const data = getCongregationFullData(cong);
                        const t = calculateCongregationTotals(data);
                        csvContent += `"${cong}",${t.entrada},${t.saida},${t.saldo}\n`;
                    });
                    csvContent += "\nCONSOLIDADO POR DEPARTAMENTO\nDepartamento,Total Entradas,Total Saídas\n";
                    departamentos.forEach(dep => {
                        csvContent += `"${dep}",${departmentTotals[dep].entrada},${departmentTotals[dep].saida}\n`;
                    });
                } else if (scope === 'single' && targetCongregation) {
                    csvContent += `Detalhamento: ${targetCongregation}\nDepartamento,Saldo Anterior,Entrada,Saída,Saldo Atual\n`;
                    const data = getCongregationFullData(targetCongregation);
                    departamentos.forEach(dep => {
                        const vals = data[dep];
                        const saldo = (Number(vals.anterior) + Number(vals.entrada) - Number(vals.saida));
                        csvContent += `"${dep}",${vals.anterior},${vals.entrada},${vals.saida},${saldo}\n`;
                    });
                    const totals = calculateCongregationTotals(data);
                    csvContent += `TOTAL,${totals.anterior},${totals.entrada},${totals.saida},${totals.saldo}\n`;
                }

                const encodedUri = encodeURI(csvContent);
                const link = document.createElement("a");
                link.setAttribute("href", encodedUri);
                link.setAttribute("download", `relatorio_${scope}_${monthNames[currentMonth]}_${currentYear}.csv`);
                document.body.appendChild(link);
                link.click();
            };

            // --- Render ---
            if (!isAuthenticated) {
                return <LoginScreen usersList={congregacoes} credentials={credentials} appConfig={appConfig} onLogin={handleLogin} />;
            }

            return (
                <div className="flex h-screen bg-gray-50 overflow-hidden">
                    {/* Sidebar */}
                    <aside className="w-64 bg-navy-900 text-white flex flex-col hidden md:flex shadow-2xl z-20">
                        <div className="p-6 border-b border-navy-800 flex items-center gap-3">
                             <div className="w-10 h-10 bg-white rounded-lg flex items-center justify-center shadow-lg overflow-hidden p-1">
                                {appConfig.logo ? (
                                    <img src={appConfig.logo} className="w-full h-full object-contain" />
                                ) : (
                                    <i className="fas fa-church text-navy-900 text-lg"></i>
                                )}
                            </div>
                            <div>
                                <h1 className="font-bold text-sm leading-tight text-gray-100">{appConfig.appName}</h1>
                                <p className="text-xs text-gold-500">{currentUser.role === 'admin' ? 'Administrador' : 'Secretaria Local'}</p>
                            </div>
                        </div>

                        <nav className="flex-1 p-4 mt-4 overflow-y-auto">
                            <p className="px-4 text-xs font-semibold text-gray-500 uppercase mb-2">Menu Principal</p>
                            <SidebarItem icon="fa-chart-pie" label={currentUser.role === 'admin' ? "Visão Geral" : "Meu Painel"} active={view === 'dashboard'} onClick={() => { setView('dashboard'); setSelectedDetailCongregation(null); }} />
                            {currentUser.role === 'admin' && (
                                <SidebarItem icon="fa-building" label="Igreja Detalhada" active={view === 'detalhada'} onClick={() => { setView('detalhada'); setSelectedDetailCongregation(null); }} />
                            )}
                            <SidebarItem icon="fa-table" label="Lançamentos" active={view === 'lancamentos'} onClick={() => { setView('lancamentos'); setSelectedDetailCongregation(null); }} />
                            <SidebarItem icon="fa-chart-bar" label="Relatórios" active={view === 'relatorios'} onClick={() => { setView('relatorios'); setSelectedDetailCongregation(null); }} />
                            {currentUser.role === 'admin' && (
                                <>
                                    <p className="px-4 text-xs font-semibold text-gray-500 uppercase mb-2 mt-6">Admin</p>
                                    <SidebarItem icon="fa-cog" label="Administração" active={view === 'admin'} onClick={() => setView('admin')} />
                                </>
                            )}
                        </nav>
                        
                        <div className="p-4 bg-navy-800 m-4 rounded-xl flex justify-between items-center">
                            <div className="flex items-center gap-2 overflow-hidden">
                                <div className="w-8 h-8 rounded-full bg-gold-500 flex items-center justify-center text-navy-900 font-bold text-xs shrink-0">
                                    {currentUser.name.substring(0,1)}
                                </div>
                                <div className="truncate">
                                    <p className="text-sm font-medium truncate w-24" title={currentUser.name}>{currentUser.name}</p>
                                </div>
                            </div>
                            <button onClick={handleLogout} className="text-gray-400 hover:text-white" title="Sair"><i className="fas fa-sign-out-alt"></i></button>
                        </div>
                    </aside>

                    {/* Main */}
                    <main className="flex-1 flex flex-col h-full relative overflow-hidden">
                        <header className="h-16 bg-white border-b border-gray-200 flex items-center justify-between px-6 z-10">
                            <div className="font-bold text-navy-900 md:hidden">{appConfig.appName}</div>
                            <div className="hidden md:block">
                                <h2 className="text-lg font-semibold text-gray-800">
                                    {view === 'dashboard' && (currentUser.role === 'admin' ? 'Painel Geral' : `Painel - ${currentUser.name}`)}
                                    {view === 'detalhada' && 'Igreja Detalhada'}
                                    {view === 'lancamentos' && 'Lançamentos Mensais'}
                                    {view === 'relatorios' && 'Relatórios e Gráficos'}
                                    {view === 'admin' && 'Administração do Sistema'}
                                </h2>
                            </div>
                            <div className="flex items-center bg-gray-50 rounded-lg border border-gray-200 p-1">
                                <button onClick={() => changeMonth(-1)} className="w-8 h-8 flex items-center justify-center rounded hover:bg-white hover:shadow-sm text-gray-500 transition"><i className="fas fa-chevron-left text-xs"></i></button>
                                <span className="px-4 text-sm font-semibold text-gray-700 min-w-[140px] text-center">{monthNames[currentMonth]} {currentYear}</span>
                                <button onClick={() => changeMonth(1)} className="w-8 h-8 flex items-center justify-center rounded hover:bg-white hover:shadow-sm text-gray-500 transition"><i className="fas fa-chevron-right text-xs"></i></button>
                            </div>
                        </header>

                        <div className="flex-1 overflow-y-auto p-4 md:p-8">
                            <div className="max-w-7xl mx-auto space-y-6 fade-in">
                                
                                {/* DASHBOARD */}
                                {view === 'dashboard' && (
                                    <>
                                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                                            <StatCard title="Saldo Anterior" value={globalTotals.tAnterior} type="default" icon="fa-history" />
                                            <StatCard title="Entradas" value={globalTotals.tEntrada} type="success" icon="fa-level-up-alt" />
                                            <StatCard title="Saídas" value={globalTotals.tSaida} type="danger" icon="fa-level-down-alt" />
                                            <StatCard title="Saldo Atual" value={globalTotals.tAtual} type="primary" icon="fa-wallet" />
                                        </div>
                                        
                                        <div className="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden flex flex-col">
                                            <div className="px-6 py-5 border-b border-gray-100 flex justify-between items-center bg-white">
                                                <div>
                                                    <h3 className="font-bold text-gray-800 text-lg">Resumo Financeiro</h3>
                                                    <p className="text-sm text-gray-400 mt-1">{currentUser.role === 'admin' ? 'Todas as Congregações' : currentUser.name}</p>
                                                </div>
                                                <button onClick={() => exportToCSV('dashboard')} className="text-sm bg-green-50 text-green-700 px-4 py-2 rounded-lg hover:bg-green-100 border border-green-200 transition font-medium flex items-center gap-2">
                                                    <i className="fas fa-file-excel"></i> Exportar
                                                </button>
                                            </div>
                                            <div className="overflow-x-auto">
                                                <table className="w-full text-left border-collapse">
                                                    <thead>
                                                        <tr className="bg-gray-50/50 border-b border-gray-100">
                                                            <th className="px-6 py-4 text-xs font-semibold text-gray-500 uppercase">Unidade</th>
                                                            <th className="px-6 py-4 text-xs font-semibold text-gray-500 uppercase text-right">Saldo Ant.</th>
                                                            <th className="px-6 py-4 text-xs font-semibold text-green-600 uppercase text-right">Entradas</th>
                                                            <th className="px-6 py-4 text-xs font-semibold text-red-600 uppercase text-right">Saídas</th>
                                                            <th className="px-6 py-4 text-xs font-semibold text-gray-800 uppercase text-right">Saldo Atual</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody className="divide-y divide-gray-100">
                                                        {visibleCongregations.map(cong => {
                                                            const totals = calculateCongregationTotals(getCongregationFullData(cong));
                                                            return (
                                                                <tr key={cong} className="hover:bg-gray-50/80 transition-colors">
                                                                    <td className="px-6 py-4 font-medium text-gray-700">{cong}</td>
                                                                    <td className="px-6 py-4 text-right text-gray-500 text-sm">{formatCurrency(totals.anterior)}</td>
                                                                    <td className="px-6 py-4 text-right text-green-600 font-medium">{formatCurrency(totals.entrada)}</td>
                                                                    <td className="px-6 py-4 text-right text-red-600 font-medium">{formatCurrency(totals.saida)}</td>
                                                                    <td className="px-6 py-4 text-right font-bold text-blue-700">{formatCurrency(totals.saldo)}</td>
                                                                </tr>
                                                            );
                                                        })}
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </>
                                )}

                                {/* ADMIN PANEL */}
                                {view === 'admin' && currentUser.role === 'admin' && (
                                    <div className="space-y-6">
                                        {/* Configurações Gerais */}
                                        <div className="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                                            <h3 className="font-bold text-gray-800 mb-4 border-b pb-2">Configurações Gerais</h3>
                                            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                                <div>
                                                    <label className="block text-sm font-medium text-gray-700 mb-1">Nome da Regional</label>
                                                    <input 
                                                        type="text" 
                                                        value={appConfig.appName} 
                                                        onChange={(e) => setAppConfig({...appConfig, appName: e.target.value})}
                                                        className="w-full border border-gray-300 rounded p-2"
                                                    />
                                                </div>
                                                <div>
                                                    <label className="block text-sm font-medium text-gray-700 mb-1">Logomarca (Login e Topo)</label>
                                                    <div className="flex items-center gap-4">
                                                        {appConfig.logo && <img src={appConfig.logo} className="h-10 w-10 object-contain border rounded" />}
                                                        <input type="file" accept="image/*" onChange={handleLogoUpload} className="text-sm text-gray-500" />
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                                            {/* Gerenciar Congregações */}
                                            <div className="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                                                <h3 className="font-bold text-gray-800 mb-4 border-b pb-2">Gerenciar Congregações</h3>
                                                <div className="flex flex-col gap-2 mb-4 bg-gray-50 p-3 rounded">
                                                    <p className="text-xs font-bold text-gray-500 uppercase">Adicionar Nova</p>
                                                    <input 
                                                        type="text" 
                                                        value={newCongName}
                                                        onChange={(e) => setNewCongName(e.target.value)}
                                                        placeholder="Nome da Congregação"
                                                        className="border border-gray-300 rounded p-2 text-sm"
                                                    />
                                                    <input 
                                                        type="text" 
                                                        value={newCongPassword}
                                                        onChange={(e) => setNewCongPassword(e.target.value)}
                                                        placeholder="Senha de Acesso"
                                                        className="border border-gray-300 rounded p-2 text-sm"
                                                    />
                                                    <button onClick={handleAddCongregation} className="bg-green-600 text-white py-1 rounded hover:bg-green-700 font-bold text-sm">Adicionar</button>
                                                </div>
                                                
                                                <div className="max-h-80 overflow-y-auto space-y-2">
                                                    {congregacoes.map((c, i) => (
                                                        <div key={i} className="bg-white border border-gray-100 p-2 rounded flex flex-col gap-2 shadow-sm">
                                                            {editCongTarget === c ? (
                                                                <div className="flex flex-col gap-2">
                                                                    <input className="border p-1 text-sm rounded" value={editCongName} onChange={e => setEditCongName(e.target.value)} />
                                                                    <input className="border p-1 text-sm rounded" value={editCongPass} onChange={e => setEditCongPass(e.target.value)} placeholder="Nova Senha" />
                                                                    <div className="flex gap-2">
                                                                        <button onClick={saveEditCongregation} className="bg-blue-500 text-white px-2 py-1 rounded text-xs">Salvar</button>
                                                                        <button onClick={() => setEditCongTarget(null)} className="bg-gray-300 px-2 py-1 rounded text-xs">Cancelar</button>
                                                                    </div>
                                                                </div>
                                                            ) : (
                                                                <div className="flex justify-between items-center">
                                                                    <span className="text-sm font-medium">{c}</span>
                                                                    <div className="flex gap-2">
                                                                        <button onClick={() => initiateEditCongregation(c)} className="text-blue-500 text-xs hover:underline">Editar</button>
                                                                        <button onClick={() => handleDeleteCongregation(c)} className="text-red-500 text-xs hover:underline">Excluir</button>
                                                                    </div>
                                                                </div>
                                                            )}
                                                        </div>
                                                    ))}
                                                </div>
                                            </div>

                                            {/* Gerenciar Departamentos */}
                                            <div className="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                                                <h3 className="font-bold text-gray-800 mb-4 border-b pb-2">Gerenciar Departamentos</h3>
                                                <div className="flex gap-2 mb-4">
                                                    <input 
                                                        type="text" 
                                                        value={newDeptName}
                                                        onChange={(e) => setNewDeptName(e.target.value)}
                                                        placeholder="Nome do Novo Departamento"
                                                        className="flex-1 border border-gray-300 rounded p-2 text-sm"
                                                    />
                                                    <button onClick={handleAddDepartment} className="bg-green-600 text-white px-3 rounded font-bold">+</button>
                                                </div>
                                                <ul className="space-y-2 max-h-80 overflow-y-auto">
                                                    {departamentos.map((d, i) => (
                                                        <li key={i} className="bg-gray-50 px-3 py-2 rounded text-sm text-gray-700 flex justify-between items-center">
                                                            {editDeptTarget === d ? (
                                                                <div className="flex gap-2 w-full">
                                                                    <input className="border p-1 text-xs flex-1" value={editDeptName} onChange={e => setEditDeptName(e.target.value)} />
                                                                    <button onClick={saveEditDepartment} className="text-green-600"><i className="fas fa-check"></i></button>
                                                                    <button onClick={() => setEditDeptTarget(null)} className="text-red-600"><i className="fas fa-times"></i></button>
                                                                </div>
                                                            ) : (
                                                                <>
                                                                    <span>{d}</span>
                                                                    <div className="flex gap-2">
                                                                        <button onClick={() => initiateEditDepartment(d)} className="text-blue-400 hover:text-blue-600"><i className="fas fa-pen"></i></button>
                                                                        <button onClick={() => handleDeleteDepartment(d)} className="text-red-400 hover:text-red-600"><i className="fas fa-trash"></i></button>
                                                                    </div>
                                                                </>
                                                            )}
                                                        </li>
                                                    ))}
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                )}

                                {/* LANÇAMENTOS */}
                                {view === 'lancamentos' && (
                                    <div className="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
                                        <div className="px-6 py-5 border-b border-gray-100">
                                            <h3 className="font-bold text-gray-800 text-lg">Lançamentos</h3>
                                            <p className="text-sm text-gray-400">Selecione para editar os valores</p>
                                        </div>
                                        <div className="overflow-x-auto">
                                            <table className="w-full text-left">
                                                <thead>
                                                    <tr className="bg-gray-50/50">
                                                        <th className="px-6 py-4 text-xs font-semibold text-gray-500 uppercase">Unidade</th>
                                                        <th className="px-6 py-4 text-xs font-semibold text-gray-500 uppercase text-right">Saldo Atual</th>
                                                        <th className="px-6 py-4 text-xs font-semibold text-gray-500 uppercase text-center">Ação</th>
                                                    </tr>
                                                </thead>
                                                <tbody className="divide-y divide-gray-100">
                                                    {visibleCongregations.map(cong => {
                                                        const totals = calculateCongregationTotals(getCongregationFullData(cong));
                                                        return (
                                                            <tr key={cong} className="hover:bg-gray-50/80">
                                                                <td className="px-6 py-4 font-medium text-gray-700">{cong}</td>
                                                                <td className="px-6 py-4 text-right font-bold text-blue-700">{formatCurrency(totals.saldo)}</td>
                                                                <td className="px-6 py-4 text-center">
                                                                    <button onClick={() => openEditModal(cong)} className="text-white bg-gold-600 hover:bg-gold-700 px-3 py-2 rounded text-sm transition shadow-sm">
                                                                        <i className="fas fa-pen mr-2"></i> Editar
                                                                    </button>
                                                                </td>
                                                            </tr>
                                                        );
                                                    })}
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                )}

                                {/* RELATÓRIOS */}
                                {view === 'relatorios' && (
                                    <div className="space-y-8">
                                        <div className="flex justify-between items-center bg-white p-4 rounded-xl shadow-sm border border-gray-200">
                                            <h3 className="text-xl font-bold text-navy-900">Relatórios</h3>
                                            <button onClick={() => exportToCSV('reports')} className="bg-navy-800 text-white px-5 py-3 rounded-lg hover:bg-navy-900 shadow-lg transition flex gap-2">
                                                <i className="fas fa-file-csv"></i> Exportar Dados
                                            </button>
                                        </div>

                                        <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                                            {/* Gráfico 1: Só mostra se houver mais de uma congregação (Admin) */}
                                            {visibleCongregations.length > 1 && (
                                                <div className="bg-white p-6 rounded-xl shadow-lg border border-gray-100">
                                                    <h3 className="font-bold text-gray-800 mb-6 border-b pb-2">Comparativo por Congregação</h3>
                                                    <div className="h-80">
                                                        <ChartComponent 
                                                            type="bar"
                                                            data={{
                                                                labels: visibleCongregations.map(c => c.substring(0, 10) + '...'),
                                                                datasets: [
                                                                    { label: 'Entradas', data: visibleCongregations.map(c => calculateCongregationTotals(getCongregationFullData(c)).entrada), backgroundColor: 'rgba(22, 163, 74, 0.8)' },
                                                                    { label: 'Saídas', data: visibleCongregations.map(c => calculateCongregationTotals(getCongregationFullData(c)).saida), backgroundColor: 'rgba(220, 38, 38, 0.8)' }
                                                                ]
                                                            }}
                                                            options={{ responsive: true, maintainAspectRatio: false }}
                                                        />
                                                    </div>
                                                </div>
                                            )}

                                            {/* Gráfico 2: Por departamento */}
                                            <div className="bg-white p-6 rounded-xl shadow-lg border border-gray-100 col-span-1 lg:col-span-2">
                                                <h3 className="font-bold text-gray-800 mb-6 border-b pb-2">Total por Departamento</h3>
                                                <div className="h-80">
                                                    <ChartComponent 
                                                        type="bar"
                                                        data={{
                                                            labels: departamentos,
                                                            datasets: [{ label: 'Entradas', data: departamentos.map(dep => departmentTotals[dep].entrada), backgroundColor: 'rgba(197, 160, 89, 0.8)' }]
                                                        }}
                                                        options={{ indexAxis: 'y', responsive: true, maintainAspectRatio: false }}
                                                    />
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                )}

                                {/* IGREJA DETALHADA (Apenas Admin) */}
                                {view === 'detalhada' && currentUser.role === 'admin' && !selectedDetailCongregation && (
                                    <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                                        {visibleCongregations.map(cong => (
                                            <div key={cong} className="bg-white p-6 rounded-xl shadow-sm border border-gray-200 hover:shadow-md transition text-center">
                                                <h3 className="font-bold text-lg text-gray-800 mb-4">{cong}</h3>
                                                <button onClick={() => setSelectedDetailCongregation(cong)} className="w-full py-2 bg-navy-800 text-white rounded-lg hover:bg-navy-900 transition">Ver Detalhes</button>
                                            </div>
                                        ))}
                                    </div>
                                )}
                                
                                {view === 'detalhada' && selectedDetailCongregation && (
                                    <div className="space-y-6">
                                        <div className="flex items-center justify-between">
                                            <button onClick={() => setSelectedDetailCongregation(null)} className="text-gray-500 hover:text-navy-900 flex items-center gap-2"><i className="fas fa-arrow-left"></i> Voltar</button>
                                            <h2 className="text-xl font-bold text-navy-900">{selectedDetailCongregation}</h2>
                                        </div>
                                        <div className="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                                            <div className="flex justify-between items-center mb-6">
                                                <h3 className="font-bold text-gray-800">Detalhamento</h3>
                                                <button onClick={() => exportToCSV('single', selectedDetailCongregation)} className="text-sm bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 flex gap-2"><i className="fas fa-file-excel"></i> Excel</button>
                                            </div>
                                            <table className="table-departments">
                                                <thead>
                                                    <tr><th>DEPARTAMENTO</th><th>SALDO ANTERIOR</th><th>ENTRADA</th><th>SAÍDA</th><th>SALDO ATUAL</th></tr>
                                                </thead>
                                                <tbody>
                                                    {departamentos.map(dep => {
                                                        const vals = getCongregationFullData(selectedDetailCongregation)[dep];
                                                        const saldo = (Number(vals?.anterior)||0) + (Number(vals?.entrada)||0) - (Number(vals?.saida)||0);
                                                        return (
                                                            <tr key={dep}>
                                                                <td>{dep}</td>
                                                                <td>{formatCurrency(vals?.anterior)}</td>
                                                                <td className="text-green-700">{formatCurrency(vals?.entrada)}</td>
                                                                <td className="text-red-700">{formatCurrency(vals?.saida)}</td>
                                                                <td className="font-bold text-blue-700">{formatCurrency(saldo)}</td>
                                                            </tr>
                                                        );
                                                    })}
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>
                    </main>

                    {/* Modal de Edição */}
                    {isModalOpen && (
                        <div className="fixed inset-0 bg-navy-900/40 backdrop-blur-sm z-50 flex items-center justify-center p-4 fade-in">
                            <div className="bg-white w-full max-w-5xl h-[90vh] rounded-2xl shadow-2xl overflow-hidden flex flex-col">
                                <div className="px-6 py-4 bg-gold-500 flex justify-between items-center text-white shrink-0">
                                    <h3 className="font-bold text-lg">{editingCongregation} - {monthNames[currentMonth]}/{currentYear}</h3>
                                    <button onClick={() => setIsModalOpen(false)} className="hover:bg-white/20 rounded-full w-8 h-8 flex items-center justify-center"><i className="fas fa-times"></i></button>
                                </div>
                                <div className="flex-1 overflow-auto p-6 bg-gray-50">
                                    <form id="departmentsForm" onSubmit={handleSave}>
                                        <table className="table-departments bg-white shadow-sm">
                                            <thead>
                                                <tr><th style={{width: '30%'}}>DEPARTAMENTOS</th><th style={{width: '15%'}}>SALDO ANTERIOR</th><th style={{width: '15%', color: '#16a34a'}}>ENTRADA</th><th style={{width: '15%', color: '#dc2626'}}>SAÍDA</th><th style={{width: '25%'}}>SALDO ATUAL</th></tr>
                                            </thead>
                                            <tbody>
                                                {departamentos.map(dep => {
                                                    const vals = editValues[dep] || { anterior: 0, entrada: 0, saida: 0 };
                                                    const saldoAtual = (Number(vals.anterior) || 0) + (Number(vals.entrada) || 0) - (Number(vals.saida) || 0);
                                                    return (
                                                        <tr key={dep}>
                                                            <td>{dep}</td>
                                                            <td><input type="number" step="0.01" value={vals.anterior || ''} onChange={(e) => handleDepartmentChange(dep, 'anterior', e.target.value)} placeholder="0,00"/></td>
                                                            <td><input type="number" step="0.01" value={vals.entrada || ''} onChange={(e) => handleDepartmentChange(dep, 'entrada', e.target.value)} className="text-green-600 font-medium" placeholder="0,00"/></td>
                                                            <td><input type="number" step="0.01" value={vals.saida || ''} onChange={(e) => handleDepartmentChange(dep, 'saida', e.target.value)} className="text-red-600 font-medium" placeholder="0,00"/></td>
                                                            <td className={`font-bold ${saldoAtual < 0 ? 'text-red-600' : 'text-blue-700'}`}>{formatCurrency(saldoAtual)}</td>
                                                        </tr>
                                                    )
                                                })}
                                            </tbody>
                                            <tfoot>
                                                <tr className="bg-gray-100 font-bold">
                                                    <td className="text-right pr-4">TOTAIS:</td>
                                                    <td>{formatCurrency(modalTotals.anterior)}</td>
                                                    <td className="text-green-700">{formatCurrency(modalTotals.entrada)}</td>
                                                    <td className="text-red-700">{formatCurrency(modalTotals.saida)}</td>
                                                    <td className="text-blue-800 text-lg">{formatCurrency(modalTotals.saldo)}</td>
                                                </tr>
                                            </tfoot>
                                        </table>
                                    </form>
                                </div>
                                <div className="p-4 border-t border-gray-200 bg-white flex justify-end gap-3 shrink-0">
                                    <button type="button" onClick={() => setIsModalOpen(false)} className="px-6 py-2 border border-gray-300 rounded text-gray-700 hover:bg-gray-50">Cancelar</button>
                                    <button type="submit" form="departmentsForm" className="px-6 py-2 bg-gold-600 text-white font-bold rounded hover:bg-gold-700 shadow">Salvar Alterações</button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
